---
title: 'Kamera'
description: 'Kamera'
---

import SnippetCameraOverlaysList from '/snippets/boards/o1/camera/listoverlays.mdx';
import SnippetCameraSetup from '/snippets/boards/o1/camera/camerasetup.mdx';
import SnippetCameraRecordVideo from '/snippets/boards/o1/camera/recordvideo.mdx';
import SnippetCameraTakePhoto from '/snippets/boards/o1/camera/takephoto.mdx';
import SnippetCameraSet from '/snippets/boards/o1/camera/cameraset.mdx';
import SnippetCameraListFormats from '/snippets/boards/o1/camera/listformats.mdx';
import SnippetUEnv from '/snippets/boards/o1/uenv.mdx';
import SnippetUEnvEdit from '/snippets/boards/o1/uenv-overlay-edit-tr.mdx';

<Tip>
Bölüm bitiminde aşağıdaki konularda deneyim kazanacaksınız

- Gemstone Obsidyen geliştirme kartına fiziksel CSI kamera bağlantısı yapmak.
- Overlay ekleyerek yazılım bağlantısını sağlamak
</Tip>

### CSI Nedir?

CSI (Camera Serial Interface), mobil cihazlarda ve gömülü sistemlerde yüksek çözünürlüklü kameralar için tasarlanmış
bir seri veri yoludur. Bu arayüz, MIPI (Mobile Industry Processor Interface) ittifakı tarafından geliştirilmiş
olup, işlemci ile kamera sensörü arasında yüksek hızda, güvenilir bir şekilde görüntü ve video verisi aktarımını
sağlar. Genellikle akıllı telefonlar, dronlar ve mini cep bilgisayarlarla kullanılan kameralarda tercih edilir.

### Adımlar

<Steps>

  <Step title="Kablo Bağlantısının Yapılması">
    Kamera ile Gemstone Obsidyen geliştirme kartı arasındaki kablonun doğru bir şekilde bağlanması gerekmektedir.
  </Step>

  <Step title="Overlay Eklenmesi">
    CSI kameranın çalışması için boot partition'da yer alan uEnv.txt dosyasına ilgili overlay eklenmelidir.
  </Step>

  <Step title="Kartın Yeniden Başlatılması">
    Tüm bu adımları tamamladıktan sonra kartı yeniden başlatmak yeterli olacaktır.
  </Step>

</Steps>

### 1. Kablo Bağlantısının Yapılması

Kamera ile Gemstone Obsidyen geliştirme kartı arasındaki kablonun doğru bir şekilde bağlanması için aşağıda yer alan
fotoğraftaki gibi bir bağlantı yapmanız gerekmektedir. İki sokete de CSI kablosunu bağlayabilirsiniz burada önemli
olan taktığınız soketin CSI'ını etkinleştiren overlayi eklemeniz gerekmektedir.

<Note>
- Kablonun bakır yollarının yer aldığı kısım soketin beyaz kısmına bakmalıdır.
- Ethernet soketine uzak olan konnektör CSI0, yakın olan konnektör ise CSI1'dir.
</Note>

<Frame caption="Kamera Kablosunun Karta Bağlanması">
  <img className="rounded-lg" noZoom src="/images/o1-board/15-camera-lens-3.png" />
</Frame>

### 2. Overlay Eklenmesi

Desteklenen kameraların overlaylerini aşağıdaki komut ile listeleyebilirsiniz.

<SnippetCameraOverlaysList />

Terminal arayüzünden `nano` isimli metin editörünü kullanarak boot klasöründe yer alan `uEnv.txt` dosyasını açınız.

```bash
sudo nano /boot/uEnv.txt
```

<Tip>
Komutu sudo ile kullandığımız için şifre soracaktır. Değiştirmediyseniz Gem-Imager ile imajı yazarken belirlemiş
olduğunuz şifreyi kullanmalısınız.
</Tip>

`uEnv.txt` dosyasının içinde bu tarz tanımlamalar bulunacaktır.

<SnippetUEnv />

Bir önceki komutla elde ettiğiniz dosya adını `overlays=` satırının sonuna boşluk bırakarak ekleyin. Örneğin
CSI0 (ethernete uzak olan konnektör) konnektörüne IMX219 kamerasını 
bağladığınızda `k3-am67a-t3-gem-o1-csi0-imx219.dtbo` dosya adını kullanmalısınız.

`uEnv.txt` dosyasının son hali böyle olacaktır. Uygun dosya adını `<dosya-adi>` kısmına yerleştirmeniz gerekmektedir.

<SnippetUEnvEdit />

### 3. Kartın Yeniden Başlatılması

`reboot` komutu ile kart yeniden başlatılmalı.

```bash
sudo reboot
```

### 4. `gem-camera-setup` Scriptinin Çalıştırılması

Aşağıdaki komut aracılığıyla karta bağlı olan kameraların kurulumu sağlanmalıdır.

<SnippetCameraSetup />

Yukarıdakine benzer bir çıktı almanız durumunda karta kamerayı başarıyla bağlamışsınızdır.

### 5. Kamera Ayarları

Başlangıçta aşağıdaki komut, bir kamera sensörünün çekirdek sürücüsü (kernel driver) ile kullanıcı
alanı (user space) uygulamaları arasında doğru bir iletişim kurulmasını sağlamak için kullanılır.
Komut çalıştırıldığında, IMX219 kamera sensörünün video çıkışı 640x480 çözünürlüğe ve SRGGB8 formatına ayarlanır.
Bu ayar, sonraki aşamada bu veri akışını kullanacak olan uygulamaların (örneğin, bir kamera uygulaması veya gstreamer)
doğru veriyi almasını sağlar.

<SnippetCameraSet />

Kameranın desteklediği formatlara aşağıdaki komuttan ulaşabilirsiniz.

<SnippetCameraListFormats />

<Warning>
`/dev/video-imx219-cam0` kısmına `gem-camera-setup` scriptinin çıktısında belirtilen cihazı girmelisiniz.
</Warning>

Aşağıda yer alan ayarlar, kameranın kazanç ve pozlama değerlerini makul bir varsayılan değere ayarlar.
Görüntünüzün soluk, çok karanlık veya hatta boş olduğunu fark ederseniz, kendi aydınlatma ortamınıza göre bu
parametreleri ayarlamanız gerekebilir. Görüntüyü düzgün gözlemlemiyorsanız, bu ayarların yanlış
olduğunun bir işareti olabilir.

```bash İç Mekan Işığı
v4l2-ctl -d /dev/v4l-subdev2 --set-ctrl=digital_gain=2048
v4l2-ctl -d /dev/v4l-subdev2 --set-ctrl=analogue_gain=230
v4l2-ctl -d /dev/v4l-subdev2 --set-ctrl=exposure=1750
```

```bash Doğal Işık
v4l2-ctl -d /dev/v4l-subdev2 --set-ctrl=digital_gain=1000
v4l2-ctl -d /dev/v4l-subdev2 --set-ctrl=analogue_gain=100
v4l2-ctl -d /dev/v4l-subdev2 --set-ctrl=exposure=1000
```

### 6. Fotoğraf Çekme

Aşağıdaki komutu çalıştırarak .jpg formatında görüntü yakalayabilirsiniz.

<SnippetCameraTakePhoto />

### 7. Video Çekme

Aşağıdaki komutu çalıştırarak .mp4 formatında bir video kaydı (100 kare) çekebilirsiniz.

<SnippetCameraRecordVideo />
