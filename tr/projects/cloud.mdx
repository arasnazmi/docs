---
title: 'Cloud'
description: 'Gemstone Kişisel Bulut Sistemi'
---

<Frame>
    <img noZoom src="/images/cloud/nextcloud-hub.png" alt="Nextcloud" />
</Frame>

<Tip>
Bölüm bitiminde aşağıdaki konularda bilgi sahibi olacaksınız.

* Gemstone geliştirme kartına [Nextcloud](https://github.com/t3gemstone/t3-gem-nextcloud) bulut sistemi kurulumu
* Mobil telefonunuz veya dış dünyadan evinizdeki Gemstone'a erişim sağlamak için kullanılan yöntemler
</Tip>

## 1. Giriş

Günümüzde kişisel verilerin kontrolü ve güvenliği her zamankinden daha önemli. Dosyalarınızı, fotoğraflarınızı,
takvimlerinizi, notlarınızı ve hatta şifrelerinizi Amazon, Google veya Microsoft gibi büyük bulut sağlayıcılarına 
bağımlı olmadan merkezi bir sistemde yönetmek isteyebilirsiniz. Bunun için self-hosting ismi verilen yöntemi
kullanmanız yani kendi sunucunuzu kendi cihazlarınızda barındırmanız gerekir. Ancak kendi evinizde sunucu çalıştırmak,
sunucuya internet bağlantısı olan heryerden erişememe ve veri güvenliğini sağlayamama gibi teknik problemleri
beraberinde getirir. Bu problemler çoğu zaman karmaşık ve yüksek maliyetli yöntemler ile çözülür. `GemCloud` projesi 
bu problemlerin kolay, maliyetsiz ve güvenli bir şekilde çözülmesini sağlar.

## 2. Nextcloud Kurulum

Nextcloud açık kaynak kodlu bir bulut çözümüdür. Fotoğraf ve dosya depolama, sohbet, takvim, şifre yöneticisi,
kanban görev planlama gibi uygulamaları bir arada sunar.

Gemstone geliştirme kartına [terminal bağlantısı](/tr/quickstart/#2-gemstone’u-keşfet) yaptıktan sonra aşağıdaki
komut ile Nextcloud kurulumunu başlatınız.

```bash
sudo apt install t3-gem-nextcloud
```

Kurulum esnasında aşağıdaki şifre girme ekranı ile karşılaşacaksınız. Bu şifre Nextcloud'un kullandığı
veritabanında ve nextcloud `admin` kullanıcı şifresi olarak kullanılmaktadır. Güçlü ve akılda kalıcı bir şifre
seçerek şifrenizi saklayınız.

<Frame>
    <img src="/images/cloud/nextcloud-password.png" alt="Nextcloud password input" />
</Frame>

Kurulum tamamlandığında nextcloud sunucusu Gemstone üzerinde çalışmaya başlayacaktır. Bir sonraki aşama ise dış dünyadan
bu bulut sistemine nasıl bağlantı kurulacağını anlatmaktadır.

## 3. Dış Dünyadan Erişim

Evinizde kullanmış olduğunuz bilgisayarlarınıza ip adresi ile erişim yalnızca ev içerisindeki ağda mümkün
olmaktadır. Son yıllarda popüler hale gelen robot süpürgeler, akıllı aydınlatma sistemleri, mobil telefondan kontrol
edilen klima ve çeşitli ev aletlerinin dış dünyadan erişelebilir olması ise bu cihazların üreticiler tarafından kurulan
çeşitli sunuculara veri aktarımı gerçekleştirilerek mümkün olmaktadır.

Gemstone Cloud projesine dış dünyadan erişebilmek için en kolay çözüm internet servis sağlayıcınızı arayarak
(ISP: TurkNet, Turktelekom, Superonline vb.) Statik IP talebinde bulunmanız ve modem ayarlarından port yönlendirmesi
yapmanızdır. Bunu yapmak istemeyen kullanıcılar için ise [Tailscale](https://tailscale.com/),
[Localtunnel](https://theboroer.github.io/localtunnel-www/) gibi çeşitli çözümler bulunmaktadır.

<Tabs>
  <Tab title="Örnek Akıllı Ev Sistem Ağı">
    ```mermaid
    flowchart
      n1@{ label: "Rectangle" }
      n1["Robot Süpürge"]
      n3["Klima"]
      n1 --- n6
      n2["Aydınlatma"] --- n6
      n3 --- n6
      n6@{ shape: "diam", label: "WIFI Modem" }
      n6@{ shape: "hex", label: "Wireless" }
      n6
      n5@{ shape: "stadium", label: "Sunucu" }
      n6@{ shape: "hex", label: "WIFI" } --- n5
      n6@{ shape: "dbl-circ", label: "WIFI" }
      n7@{ shape: "doc", label: "Mobil Telefon" }
      style n6 fill:#C1FF72
      n7@{ shape: "diam", label: "Mobil Telefon" }
      n5@{ shape: "stadium", label: "Üretici Sunucusu" } --- n7@{ shape: "hex", label: "Mobil Telefon" }
      n8
      n8["Akıllı Ev Sistemleri"] --- n6
      style n7 fill:#00BF63
      n5@{ shape: "lin-cyl", label: "Server" }
    ```
  </Tab>
  <Tab title="ISP Modem ve Lokal Ağ">
    <img noZoom height="600" width="600" src="/images/cloud/isp-nat-local.png" alt="Tailscale" />
  </Tab>
</Tabs>

Temel mantığı bilgisayarınıza kurmuş olduğunuz bir servis ile Tailscale haberleşmesi yaparak dış dünyadan yine tailscale
üzerinden bilgisayarınıza erişmenizi sağlamasıdır.

### 3.1. Tailscale Kurulum

<Frame>
    <img src="/images/cloud/tailscale-web.jpg" alt="Tailscale" />
</Frame>

Bu [bağlantıya](https://login.tailscale.com/start) tıklayarak Github, Google veya Microsoft hesabınızla 
Tailscale'e kayıt olunuz.

<Frame>
    <img src="/images/cloud/tailscale-signup.png" alt="Tailscale signup" />
</Frame>

Hesabınıza giriş yaptığınızda karşınıza Tailscale kontrol paneli çıkacaktır. Gemstone kartı eklemek
için `Machines -> Add device -> Linux server` seçeneğini seçiniz.

<Frame>
    <img src="/images/cloud/gemstone-ekle.png" alt="Gemstone ekle" />
</Frame>

Sayfanın en altına inip `Generate install script` butonuna tıklayarak oluşan tailscale kurulum 
komutunu kopyalayınız. Ardından Gemstone karta [terminal bağlantısı yaparak](/tr/quickstart/#2-gemstone’u-keşfet)
kopyaladığınız komutu terminalde çalıştırınız.

<Frame>
    <img src="/images/cloud/gen-install-script.png" alt="Install script" />
</Frame>

Tailscale kurulumunu tamamlandıktan sonra aşağıdaki komut ile tailscale servislerini başlatınız.

```bash
sudo tailscale up
```
 
Bağlantının sağlıklı olduğunu, Tailscale Kontrol Panelindeki `Machines` bölümünden `Connected` yazıp yazmadığına
bakarak doğrulayınız.

<Frame>
    <img src="/images/cloud/gem-machine-list.png" alt="Tailnet machine list" />
</Frame>

Bir sonraki adım ise Nextcloud sunucusunu tailnetten erişilebilir hale getirmektir. Kontrol panelinde
`DNS` menüsüne girip sayfanın en altında bulunan `Enable HTTPS` butonuna, ardından `Enable` butonuna
tıklayınız.

<Frame>
    <img src="/images/cloud/enable-https.png" alt="Tailnet HTTPS enable" />
</Frame>

Geliştirme kartına terminal bağlantısı yapıp aşağıdaki komut ile Nextcloud'u ağdaki diğer cihazlarla paylaşıma açık
hale getiriniz.

```bash
sudo tailscale serve --bg --http=80 1453
```

Bu adımdan sonra bu ağa eklenen diğer cihazlar Nextcloud'a http://gemstone adresinden erişebilirler. Ağa client cihaz 
(Örneğin Cep telefonu, kişisel bilgisayar veya tablet) eklemek için ise cihaz ekleme bölümündeki diğer seçenek olan
`Machines -> Add device ->  Client device` seçeneğini seçiniz.

<Frame>
    <img src="/images/cloud/client-add.png" alt="Tailnet Add Client device" />
</Frame>

Açılan ekranda cihazınıza kurulum talimatlarını takip ederek eklemek istediğiniz cihazda Tailscale kurulumunu
tamamlayınız. Tailscale uygulamasını başlatarak işletim sisteminize uygun yöntemle giriş yapınız. İşlemleri
tamamladığınızda kontrol panelinde makineyi `Connected` etiketiyle görmeniz gerekmektedir.

<Frame>
    <img src="/images/cloud/client-list.png" alt="Tailnet device list" />
</Frame>

Eklediğimiz cihazda tarayıcıdan http://gemstone adresine gidildiğinde Nextcloud giriş sayfasıyla karşılaşacaksınız.
Yönetici hesabının kullanıcı adı `admin` şifresi ise kurulum esnasında girdiğiniz `CLOUD` şifresidir.

<Frame>
    <img src="/images/cloud/nextcloud-login.png" alt="Nextcloud login" />
</Frame>

### 3.4. Tailscale Neden Kullanılıyor ?

IPv4 adreslerinin sınırlı sayıda olması nedeniyle, internet servis sağlayıcıları CGNAT (Carrier-Grade NAT) kullanarak
birden fazla kullanıcıyı tek bir IPv4 adresi üzerinden internete çıkarır. Bu durum, evde çalışan sunuculara
(bizim durumumuzda Nextcloud) doğrudan erişimi engeller. Tailscale, bu sorunu çözmek için WireGuard tabanlı bir
VPN ağı kurarak, CGNAT ve geleneksel NAT engellerini aşar. Kullanıcılar, internet erişimi olan her yerden, yalnızca
yetkilendirilmiş cihazlarla güvenli bir şekilde Nextcloud sunucusuna bağlanabilir. Böylece, herkese açık IP
paylaşımına gerek kalmadan, kapalı ve kontrollü
bir ağ ortamı sağlar.

### 3.5. Static IP ile Kullanım

Yapım aşamasında...

## 4. Gelişmiş Güvenlik

### 4.1. Nextcloud İki Adımlı Doğrulama

Admin hesabına giriş yaptıktan sonra üste bulunan profil resmine tıklayarak, açılan menüden `Personal Settings`
seçeneğine tıklayınız. 

<Frame>
    <img src="/images/cloud/nc-user-menu.png" alt="Nextcloud user menu" />
</Frame>

Ardından sol menüden `Security` seçeneğini seçip `Enable TOTP` kutucuğunu işaretleyiniz. 

<Frame>
    <img src="/images/cloud/security-settings.png" alt="Nextcloud security settings" />
</Frame>

Bu seçeneği işaretlediğinizde oluşan şifreyi veya QR kodu; doğrulama uygulamanıza girerek şifre oluşturunuz. 
Son olarak üretilen kodu `Authentication` alanına girip `Verify` butonuna tıklayarak işlemi tamamlayınız.

<Frame>
    <img src="/images/cloud/totp-enable.png" alt="Nextcloud totp enable" />
</Frame>

Artık hesabınıza girişte şifrenize ek olarak doğrulama kodu da kullanmanız ilave güvenlik önlemi olarak
aktifleşmiş olacaktır.

### 4.2. Tailscale Tailnet Lock Aktifleştirme

Kurulan bu sistemde Nextcloud'a erişim yalnızca tailnet ağına eklediğimiz cihazlarla yapılabildiğinden sistem güvenlidir. 
Ancak burada ağa eklenecek cihazları kontrol eden `Tailscale` firmasının `Coordination Server` ismini verdiği kapalı
kaynaklı bir sunucusu mevcuttur. Tailnet'e bir cihazın katılıp katılamayacağının kararı bu sunucu tarafından
verilmektedir.

En kötü senaryoda Tailscale firması sizi hedef alırsa, `Coordination Server` kullanarak sizin izniniz dışında
tailnetinize cihaz ekleyebilir. `Tailscale` firması bu sorunu `Tailnet Lock` ismi verilen bir yöntemle çözmektedir.
Tailnet Lock; ağa katılmaya olanak sağlayan anahtarları Tailscale firmasının kendi `Coordination Server`inde
tutmak yerine sizin belirlediğiniz ağınızda bulunan iki cihazda tutmaktadır. Böylelikle tailnetinize girişleri 
yalnızca bu iki cihaz yönetebilmektedir.

Kontrol panelinden `Settings -> Device management -> Enable tailnet lock` butonuna tıklayınız.

<Frame>
    <img src="/images/cloud/enable-tailnet-lock-page.png" alt="Tailnet lock page" />
</Frame>

Enable tailnet lock ekranında `Add new signing node` butonuna tıklayıp hali hazırda tailnette bulunan iki cihazı seçiniz.
Eğer sizin tailnetinizde başka cihazlar da varsa burada seçilen cihazlar güvendiğiniz cihazlar olmalıdır.

<Frame>
    <img src="/images/cloud/tailnet-sign-nodes.png" alt="Tailnet sign nodes" />
</Frame>

Tailnet lock aktifleştirildiğinde geri dönebilmek için tek yol Tailnet lock devre dışı bırakma kodlarıdır
(Tailnet lock disablement secret). Eğer ağınıza bir şekilde erişimi kaybederseniz ağı kurtarmak bu kodlar
olmadan mümkün değildir. Tailscale firması bu kodlardan birini kendi destek sistemlerine göndermenizi
tavsiye etmektedir fakat bunun yerine şifreleri kendi güvendiğiniz bir yerde muhafaza edebilirsiniz.

`Configure disablement options` bölümüne gidip `Don’t send disablement secret to Tailscale support` seçeneğine tıklayınız.
`Run command from signing node` bölümünde oluşan komutu kopyalayıp eklediğimiz cihazların birinde çalıştırmamız gerekmektedir.
(Örneğin Gemstone kartta çalıştırabilirsiniz.)

<Frame>
    <img src="/images/cloud/tailnet-lock-cmd.png" alt="Tailnet lock cmd" />
</Frame>

Çalıştırdığınızda oluşan `disablement-secret:XXXXXXXX` şeklindeki devre dışı bırakma kodlarını güvenli bir yere not
ediniz.  Kontrol panelinde `Machines` kısmında ise seçtiğimiz iki cihazın altında `Signing node` ibaresini
görmemiz gerekmektedir.

<Frame>
    <img src="/images/cloud/after-tailnet-lock.png" alt="After Tailnet lock" />
</Frame>

Artık yeni cihaz oluşturduğunuzda, ilgili cihazlar doğrudan ağınıza bağlanamayacaklar bunun yerine aşağıdaki
gibi `Locked out` olarak gözükeceklerdir.

<Frame>
    <img src="/images/cloud/tailnet-locked-out.png" alt="Tailnet locked out" />
</Frame>

Bu cihazlar Signing node cihazlarının birinden aktifleştirilmelidir. Bunun için Signing node cihazında eklenecek
cihaza tıklayıp `Sign machine` butonuna basılmalı ardından cihazın işletim sistemine uygun seçeneklerden biri
seçilip sign işlemi tamamlanmalıdır. İşlemin ardından cihaz ağa bağlanmış olur. Sign işlemini Gemstone kartta
yapmak için `CLI` seçeneğini seçip oluşan komutu karta terminal bağlantısı yapıp terminalde çalıştırınız.

<Frame>
    <img src="/images/cloud/tailnet-sign-machine.png" alt="Tailnet sign" />
</Frame>
