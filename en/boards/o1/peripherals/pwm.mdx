---
title: 'PWM'
description: 'Pulse Width Modulation (PWM)'
---

import SnippetDevices from '/snippets/boards/o1/pwm/devices.mdx';
import SnippetExport1 from '/snippets/boards/o1/pwm/export1.mdx';
import SnippetExport2 from '/snippets/boards/o1/pwm/export2.mdx';
import SnippetEnable from '/snippets/boards/o1/pwm/enable.mdx';
import SnippetDisable from '/snippets/boards/o1/pwm/disable.mdx';
import SnippetUnexport from '/snippets/boards/o1/pwm/unexport.mdx';

PWM (Pulse Width Modulation) is a modulation technique used to control the average power level of a signal.
Its basic working principle relies on adjusting the "on" and "off" durations (duty cycle) of a square wave
with a fixed period. In embedded systems, it is used for various purposes such as motor speed control, LED
brightness adjustment, servo motor control, power converters, and analog signal generation. For example,
when controlling a motor's speed with PWM, as the duty cycle value increases, the average voltage delivered
to the motor increases, causing the motor to rotate faster.

The **period**, one of the fundamental parameters of a PWM signal, is the duration of one complete waveform
cycle. The **duty cycle** is the duration during which the signal remains "on" within one period.
**Polarity** determines the active state of the PWM signal (high or low level). For instance, in normal
polarity, the duty cycle represents the high level, while in inverted polarity, it represents the low level.

### PWM Interfaces

The PWM interfaces available on the T3-GEM-O1 board are listed in the table below.

<Frame caption="Todo: The image of the board on which the PWM pins are marked">
  <img className="rounded-lg" noZoom src="/images/under-construction.png" />
</Frame>

<SnippetDevices int="Interface" device="Device" file="Overlay File" />

<Note>
To enable PWM-0A and PWM-0B together: `k3-am67a-t3-gem-o1-pwm-epwm0-gpio5-gpio14.dtso`

To enable PWM-1A and PWM-1B together: `k3-am67a-t3-gem-o1-pwm-epwm1-gpio6-gpio13.dtso`
</Note>

<Warning>
The `pwmchip3` and `pwmchip5` chips have two channels, and each channel can be used as a PWM device.
However, **different period values CANNOT be assigned** to the two channels of a single PWM chip
(e.g., PWM-0A and PWM-0B). As long as the same period value is given to both channels, there is no
issue in assigning different duty cycles.
</Warning>

The names of the overlay files for the interfaces to be enabled must be added to the `overlays` variable
in the `/boot/uEnv.txt` file. Detailed information about overlays can be found in the
[Device Tree](./introduction/#2-device-tree) section.

When all overlays are enabled, there are **8 separate PWM interfaces** available: 1 from the FAN header
and 7 from the 40-pin header.

### PWM Usage

PWM chips can be accessed via the `/sys/class/pwm` directory. Before using a PWM device, an `export` operation
must be performed. For example, referring to the table above, the `PWM-ECAP0` interface corresponds to the
`pwm0` device of the `pwmchip0` chip. After executing the following command, the `/sys/class/pwm/pwmchip0/pwm0`
device will be created. The reason for writing `echo 0` is that it corresponds to `pwm0`, i.e., device number `0`.

<SnippetExport1 />

Similarly, if the `PWM-0B` interface is to be used, the `pwm1` device of the `pwmchip3` chip should be activated
as shown in the following command. The reason for writing `echo 1` is that it corresponds to `pwm1`, i.e.,
device number `1`.

<SnippetExport2 />

After the `export` operation, the `period` and `duty_cycle` variables (in nanoseconds) can be set to desired
values as shown in the example below. Once the `enable` variable is set to `1`, the PWM output can be obtained.

<SnippetEnable />

To stop the PWM output, set the `enable` variable to `0`.

<SnippetDisable />

If the PWM device is no longer needed, an `unexport` operation can be performed. This will remove the
device from the system. The reason for writing `echo 0` is that it corresponds to `pwm0`, i.e., device number `0`.

<SnippetUnexport />
